
<head>


<link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="script.js"></script>
</head>


<div id="sidesL"></div>
<div id="sidesR">  </div>
<div id="sidesT">
</div>
<div id="sideBar">

    <form method="post">

   <h2>  Load a game! </h2>
    <form method="post">
        Load your game <br>
        Player 1 Username: <input type="text" placeholder="username" name="username1"><br>
        Player 1 Password: <input type="password" placeholder="password" name="password1"><br>
        <br>
        Player 2 Username: <input type="text" placeholder="username" name="username2"><br>
        Player 2 Password: <input type="password" placeholder="password" name="password2"><br>
 <br>
        <button type="submit">Load Game</button>
    </form>
    <form method="post">
        <br><br>
        Save your game <br>
        Player 1 Username: <input type="text" placeholder="username" name="username3"><br>
        Player 1 Password: <input type="password" placeholder="password" name="password3"><br>
        <br>
        Player 2 Username: <input type="text" placeholder="username" name="username4"><br>
        Player 2 Password: <input type="password" placeholder="password" name="password4"><br>
        <br>
        <button type="submit">Save Game</button>
        <br> <br>
        <a href="account.php" >View Player 1 account </a>


</div>
<div id="board">



    <div class="tileBlack"  id="1">
        <img src="http://www.clipartbest.com/cliparts/dTr/aRg/dTraRgkjc.png" class="sprite">

    </div>
    <div class="tileWhite" id="2">
        <img src="http://www.wpclipart.com/recreation/games/chess/chess_set_1/chess_piece_black_king_T.png" class="sprite">
    </div>
    <div class="tileBlack" id="3">
    </div>
    <div class="tileWhite" id="4"></div>
    <div class="tileBlack" id="5"></div>
    <div class="tileWhite" id="6" ></div>
    <div class="tileBlack" id="7" ></div>
    <div class="tileWhite" id="8"></div>

    <div class="tileWhite" id="9" ></div>
    <div class="tileBlack" id="10" ></div>
    <div class="tileWhite" id="11"></div>
    <div class="tileBlack" id="12"></div>
    <div class="tileWhite" id="13" ></div>
    <div class="tileBlack" id="14"></div>
    <div class="tileWhite" id="15"></div>
    <div class="tileBlack" id="16"></div>

    <div class="tileBlack" id="17"></div>
    <div class="tileWhite" id="18"></div>
    <div class="tileBlack" id="19"></div>
    <div class="tileWhite" id="20"></div>
    <div class="tileBlack" id="21"></div>
    <div class="tileWhite" id="22"></div>
    <div class="tileBlack" id="23"></div>
    <div class="tileWhite" id="24"></div>

    <div class="tileWhite" id="25"></div>
    <div class="tileBlack" id="26"></div>
    <div class="tileWhite" id="27"></div>
    <div class="tileBlack" id="28"></div>
    <div class="tileWhite" id="29"></div>
    <div class="tileBlack" id="30"></div>
    <div class="tileWhite" id="31"></div>
    <div class="tileBlack" id="32"></div>

    <div class="tileBlack" id="33"></div>
    <div class="tileWhite" id="34"></div>
    <div class="tileBlack" id="35"></div>
    <div class="tileWhite" id="36"></div>
    <div class="tileBlack" id="37"></div>
    <div class="tileWhite" id="38"></div>
    <div class="tileBlack" id="39"></div>
    <div class="tileWhite" id="40"></div>

    <div class="tileWhite" id="41"></div>
    <div class="tileBlack" id="42"></div>
    <div class="tileWhite" id="43"></div>
    <div class="tileBlack" id="44"></div>
    <div class="tileWhite" id="45"></div>
    <div class="tileBlack" id="46"></div>
    <div class="tileWhite" id="47"></div>
    <div class="tileBlack" id="48"> <h6> Things in here </h6> </div>


    <input type="hidden" name="1" value="null">
    <input type="hidden" name="2" value="null">
    <input type="hidden" name="3" value="null">
    <input type="hidden" name="4" value="null">
    <input type="hidden" name="5" value="null">
    <input type="hidden" name="6" value="null">
    <input type="hidden" name="7" value="null">
    <input type="hidden" name="8" value="null">

    <input type="hidden" name="9" value="null">
    <input type="hidden" name="10" value="null">
    <input type="hidden" name="11" value="null">
    <input type="hidden" name="12" value="null">
    <input type="hidden" name="13" value="null">
    <input type="hidden" name="14" value="null">
    <input type="hidden" name="15" value="null">
    <input type="hidden" name="16" value="null">

    <input type="hidden" name="17" value="null">
    <input type="hidden" name="18" value="null">
    <input type="hidden" name="19" value="null">
    <input type="hidden" name="20" value="null">
    <input type="hidden" name="21" value="null">
    <input type="hidden" name="22" value="null">
    <input type="hidden" name="23" value="null">
    <input type="hidden" name="24" value="null">

    <input type="hidden" name="25" value="null">
    <input type="hidden" name="26" value="null">
    <input type="hidden" name="27" value="null">
    <input type="hidden" name="28" value="null">
    <input type="hidden" name="29" value="null">
    <input type="hidden" name="30" value="null">
    <input type="hidden" name="31" value="null">
    <input type="hidden" name="32" value="null">

    <input type="hidden" name="33" value="null">
    <input type="hidden" name="34" value="null">
    <input type="hidden" name="35" value="null">
    <input type="hidden" name="36" value="null">
    <input type="hidden" name="37" value="null">
    <input type="hidden" name="38" value="null">
    <input type="hidden" name="39" value="null">
    <input type="hidden" name="40" value="null">

    <input type="hidden" name="41" value="null">
    <input type="hidden" name="42" value="null">
    <input type="hidden" name="43" value="null">
    <input type="hidden" name="44" value="null">
    <input type="hidden" name="45" value="null">
    <input type="hidden" name="46" value="null">
    <input type="hidden" name="47" value="null">
    <input type="hidden" name="48" value="null">






    </form>
</div>
<div id="sidesB"> </div>

<?php


function get_string_between($string, $start, $end){
    $string = ' ' . $string;
    $ini = strpos($string, $start);
    if ($ini == 0) return '';
    $ini += strlen($start);
    $len = strpos($string, $end, $ini) - $ini;
    return substr($string, $ini, $len);

}
//Save Game
if ($_POST['username3'] != null && $_POST['username4'] != null && $_POST['password3'] != null && $_POST['password4'] != null ) {
    $board = "";
    $i = 1;
    while ($i != 49) {

        if ($i == 1) {
            $board = "xspacex1" . $board . $_POST[$i] . "xspacex" . ($i + 1) ;
        }
        else {
            $board = $board . $_POST[$i] . "xspacex" . ($i + 1) ;
        }
        $i++;
    }

    $dbh = new PDO('mysql:host=localhost;dbname=mydb', 'root', 'root');

    $query = "SELECT * FROM subscription WHERE username1 = :username1 AND username2 = :username2 AND password1 = :password1 AND password2 = :password2";
    $stmt = $dbh->prepare($query);
    $stmt->execute(array('username1' => $_POST['username1'],
        'username1' => $_POST['username3'],
        'password1' => $_POST['password3'],
        'username2' => $_POST['username4'],
        'password2' => $_POST['password4'],
    ));
    $result= $stmt->fetchAll();
$existing = 0;
    foreach($result as $row) {
    $existing = 1;
        echo "found a thing!";
    }
    echo " no things found";
        if ($existing == 1) {
            $dbh = new PDO('mysql:host=localhost;dbname=mydb', 'root', 'root');
            // Write the data to the database
            $query = "UPDATE subscription SET board = :board WHERE username1 = :username1 AND username2 = :username2";
            $stmt = $dbh->prepare($query);
            $result = $stmt->execute(
                array(
                    'username1' => $_POST['username3'],
                    'username2' => $_POST['username4'],
                    'board' => $board
                )
            );
        }
    else {
        $dbh = new PDO('mysql:host=localhost;dbname=mydb', 'root', 'root');
        //Write the data to the database
        $query = "INSERT INTO subscription VALUES (0, :username3, :password3, :username4, :password4, :board, NULL)";
        $stmt = $dbh->prepare($query);
        $result = $stmt->execute(
            array(
                'username3' => $_POST['username3'],
                'password3' => $_POST['password3'],
                'username4' => $_POST['username4'],
                'password4' => $_POST['password4'],
                'board' => $board
            ));
    }




}


//load game
if ($_POST['username1'] != null && $_POST['username2'] != null && $_POST['password1'] != null && $_POST['password2'] != null ) {


    $dbh = new PDO('mysql:host=localhost;dbname=mydb', 'root', 'root');

    $query = "SELECT * FROM subscription WHERE username1 = :username1 AND username2 = :username2 AND password1 = :password1 AND password2 = :password2";
    $stmt = $dbh->prepare($query);
    $stmt->execute(array('username1' => $_POST['username1'],
                            'username2' => $_POST['username2'],
                            'password1' => $_POST['password1'],
                            'password2' => $_POST['password2']
        ));
    $result= $stmt->fetchAll();

    foreach($result as $row) {

        $i = 1;
        while ($i != 49) {
            $start = "xspacex" . $i;
            $end = "xspacex" . ($i + 1);
           $image = get_string_between($row['board'], $start, $end);
            if ($image != 'null') {
                echo "<script type='text/javascript'>
document.getElementById('" . $i . "').innerHTML = '<img src=\'" . $image . "\' class=\'sprite\'>';
</script>";
            }
            else {
                echo "<script type='text/javascript'>
document.getElementById('" . $i . "').innerHTML = '';
</script>";
            }

            //echo " i = " . $i . " image = " . $image;

            $i++;
        }
    }
}


// send emails to players if they haven't played in a week.
//$date = date('d');
//$time = time();
//
//if ($date == (date('d') + 7) && $time = time()) {
//
//
//    $query = "SELECT lastPlayed FROM subscription";
//    $stmt = $dbh->prepare($query);
//    $stmt->execute();
//    $result = $stmt->fetchAll();
//
//    foreach ($result as $row) {
//        $subject = "Still interested in chess?";
//        $msg = "It's been a week since you last played. Want to play again?";
//        $from = "playchessbecauseit'sfun@gmail.com";
//        mail($row['text'], $subject, $msg, 'From:' . $from);
//    }
//}





?>